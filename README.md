># Проектная работа "Веб-ларек"
### Описание: "Веб-ларек" - это интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 

>## Стек: HTML, SCSS, TS, Webpack

>### Структура проекта:
- src/ — исходные файлы проекта,
- src/components/ — папка с TS компонентами,
- src/components/base/ — папка с базовым кодом.

>### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы,
- src/types/index.ts — файл с типами,
- src/index.ts — точка входа приложения,
- src/scss/styles.scss — корневой файл стилей,
- src/utils/constants.ts — файл с константами,
- src/utils/utils.ts — файл с утилитами.

>## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
>## Данные и типы данных, используемые в приложении

Интерфейс карточки товара. Данные карточки приходят со стороны сервера

```
interface IProductItem{
  id: string;
  description: string;
  image: string;
  title: string;
  category: TCategoryProduct;
  price: number | null;
}
```

Тип для типизации поля category интерфейса IProductItem карточки товара

```
type TCategoryProduct = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Данные пользователя в форме для выбора способа доставки и ввода адреса доставки

```
interface IOrderForm {
    payment: string;
    address: string;
}
```

Данные пользователя в форме для ввода email и телефона

```
interface IContactsForm {
  email: string;
  phone: string;
}
```

Интерфейс объекта заказа. Данный объект нужен для оформления POST запроса на сервер, при оформлении заказа

```
interface IOrder extends IOrderForm, IContactsForm {
  total: number;
  items: string[];
}
```

После отправки запроса с данными зака, получаем ответ с объектом, соответствующему данному интерфейсу, при успешной отработки запроса сервером

```
interface IOrderResult {
  id: string;
  total: number;
}
```

Тип объкта ошибки полей ввода

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

>## Архитектура приложения

>Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

>### Базовый код

>>#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер,
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

>>#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события.

>>#### Класс Model
Базовая модель, чтобы можно было отличить ее от простых объектов с данными.  
Конструктор класса принимает инстант брокера событий.
- ` emitChanges` - метод сообщает, что модель поменялась.

>>#### Абстрактный класс Component
Через инструментарий данного класса размещают данные в разметку. Содержит методы для работы с DOM в дочерних компонентах:
-    `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключить класс.
-    `protected setText(element: HTMLElement, value: unknown)` - установить текстовое содержимое.
-    `setDisabled(element: HTMLElement, state: boolean)` - сменить статус блокировки.
-    `protected setHidden(element: HTMLElement)` - скрыть элемент.
-    `protected setVisible(element: HTMLElement)` - показать элемент.
-    `protected setImage(element: HTMLImageElement, src: string, alt?: string)` - установить изображение с алтернативным текстом.
-    `render(data?: Partial<T>): HTMLElement` - вернуть корневой DOM-элемент. Данный метод получает опционально данные и если эти данные есть, то он постарается установить их в объект. Пример: для карточки товара установит содержимое заголовка, изображение и т.д. 


>### Слой данных

>>#### Класс AppState
Класс отвечает за хранение и логику работы с данными приложения "Веб-ларек". Данный класс наследуется от родительского класса Мodel, у которого конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- `catalog: IProductItem[];` - массив с объектами, содержащими данные карточек товара,
- `order: IOrder` - объект с данными, нужными для оформления заказа,
- `formErrors: FormErrors` - объект с ошибками, возникающими при некорректном заполнении форм.

Так же класс предоставляет метод для взаимодействия с этими данными:
- `toggleOrderedLot(id: string, isIncluded: boolean):void` - отвечает за добавление/исключение id карточки товара в поле items объекта order: IOrder, при добавлении/удалении товара из корзины.
- `isIncludedCard(cardId:string):boolean` - проверяет наличие по id карточки в списке отложенных товаров.
- `clearBasket():void` - после успешного оформления заказа, при вызове данного метода, происходит очистка массива с объектами, с данными карточек товара, в поле catalog. Карточки из корзины будут удалены.
- `getTotal():number` - возвращает общую сумму отложенных товаров в корзине.
- `setCatalog(items: IProductItem[]):void` - устанавливает значение поля catalog, содержащее массив с объектами(IProductItem) карточек товара. Вызван сразу после загрузки данных карточек товаров с севера.
- `getAddProductInBasket(): IProductItem[]` - возвращает массив с объектами данных карточек товаров, добавленных в корзину.
- `setOrderField(field: keyof IOrderForm, value: string):void` - cохроняет в поле order информацию о заказе, полученную из формы выбора способа оплаты и адреса доставки, с проверкой на валидность полей.
- `validateOrderForm():boolean` - проверяет наличие данных о способе оплаты и адресе доставки, если соответствующих данных нет в поле зака order, сохраняет данные об ошибке.
- `setСontactsField(field: keyof IContactsForm, value: string):void` - cохроняет в поле order информацию о заказе, полученную из формы для ввода email и телефона, с проверкой на валидность полей.
- `validateСontactsForm():boolean`- проверяет наличие данных email и телефона, если соответствующих данных нет в поле зака order, сохраняет данные об ошибке,
- `getCountItems():number` - возвращает число отложенных товаров в корзину.
- `resetForm():void` - очищает вводимые данные полей заказа, для активации валидации, после закрытия модального окна крестиком/кликом по оверлею


>### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

>>#### Класс Modal

Реализует модальное окно.  
Наследует класс Component. 

Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна при клике на иконку с крестиком и при клике на оверелей.

- `constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает DOM-элемент модального окна, и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
- `_content: HTMLElement` - DOM-элемент, который нужно отобразить в модальном окне. В нашем проекте такими элементами будут экземпляры классов: BasKet, CardPreview, OrderForm, ContactsForm, Success.

Методы:
- `set content(value: HTMLElement)` - сеттер для установки значения в поле _content.
- `render(data: IModalData): HTMLElement` - расширение родительского метода.


>>#### Класс Card
Класс Card используется для отображения карточки. Данный класс предоставляет своим классам наследникам полезные поля и методы, в целях исключения дублирования кода.
Наследует класс Component.

В конструктор класса `constructor(protected container: HTMLElement, actions?: ICardActions)`:
- передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.
- конструктор, кроме темплейта принимает объект с функцией обработчик событий по клику.
- в конструкторе устанавливается слушатель на элемент кнопки карточки, при его наличии, либо на саму карточку, в результате взаимодействия, с которыми, пользователя, генерируются соответствующие события.\

Поля класса содержат элементы разметки элементов карточки:
- `protected _title: HTMLElement` - элемент заголовка,
- `protected _price: HTMLElement` - элемент для отображения информации о цене, 
- `protected _image?: HTMLImageElement` - элемент изображения,
- `protected _description?: HTMLElement` - элемент для отображения подробного описания товара, 
- `protected _category?: HTMLElement` - элемент для отображения информации о категории товара, 
- `protected _button?: HTMLButtonElement` - элемент кнопки.

Методы:
- `set id(value: string)` - сеттер для установки значения id в атрибут dataset карточки,
- `set title(value: string)` - сеттер для установки значения заголовка карточки,
- `set price(value: number)` - сеттер для установки значения цены карточки,
- `set buttonName(value: string)` - сеттер для установки текста(названия) кнопки,
- `set statusButton(value: number)` - сеттер для установки статуса актиности кнопки,
- `set image(value: string)` - сеттер для установки значения атрибута src у элемента изображения карточки,
- `set description(value: string)` - сеттер для установки текса с подробным описанием информации карточки,
- `set category(value: string)` - сеттер для установки значения категория карточки,
- `setColorCategory(value: TCategoryProduct, settings: Record<TCategoryProduct, string>):void` - метод окрашивающий элемент категории карточки в зависимости от его текстовго значения 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'.

>>>#### Класс CardCatalog
Класс CardCatalog наследует класс Card. 
Класс используется для отображения карточки, расположенной  в галерее на главной странице сайта, задавая в карточке данные названия, изображения, категории, цены. При клике на саму карточку инициируется событие, при котором будет открыто модальной окно с отображением кликнутой карточки.\

>>>#### Класс CardPreview
Класс CardPreview наследует класс Card.
Класс используется для отображения выбранной карточки превью в модальном окне, задавая в карточке данные названия, изображения, категории, цены, описания. При клике на кнопку карточки "В корзину" происходит добавление карточки в корзину и закрытие модального окна.

>>>#### Класс CardBasket
Класс CardBasket наследует класс Card.
Класс используется для отображения карточки в каталоге корзины, задавая в карточке данные названия, цены, порядково номера. При клике на иконку с ведерком карточка удаляется из корзины.

Содержит дополнительное поле для элемента разметки порядково номера карточки:
- `protected _itemIndex: HTMLElement` - элемент для отображения порядкого номера карточки в каталоге корзины.

Метод:
- `set index(value: number)` - сеттер для установки порядкого номера карточки в каталоге корзины.

>>#### Класс Page
Отвечает за отображение блока с карточками на главной странице и счетчика отложенных товаров в корзину. В конструктор принимает DOM элемент body и экземпляр `EventEmitter` для инициации события (basket:open), при нажатии пользователем на иконку корзины. В следствии откроется модальное окно с отображением перечня карточек в каталоге корзины.
Наследует класс Component.

Поля:
- `protected _counter: HTMLElement` - элемент счетчика, для отображения количества отложенных карточек в корзину,
- `protected _catalog: HTMLElement` - элемент каталога, для размещения в нем карточек товаров на главной странице,
- `protected _wrapper: HTMLElement` - элемент обертки содержимого body,
- `protected _basket: HTMLElement` - элемент корзины. На данный элемент, при инициализации в конструкторе, навешивается слушатель события, в результате чего при клике на него, будет открыто модальное окно с отображением корзины класса Basket.

Методы:
- `set counter(value: number)` - сеттер для установки значения счетчика товаров, отложенных в корзину,    
- `set catalog(items: HTMLElement[])` - сеттер для размещения внутри каталога дочерних элементов карточек каталога, 
- `set locked(value: boolean)` - сеттер устанавливает состояние прокрутки.

>>#### Класс Basket 
Отвечает за отображение перечня отложенных карточек товара в корзину. Наследует класс Component. В конструктор передается DOM элемент темплейта корзины и экземпляр `EventEmitter` для инициации события (order:open), при нажатии пользователем на кнопку корзины 'Оформить'. В следствии откроется модальное окно с формой для выбора способа оплаты и ввода адреса доставки, а так же в объект order модели данных будет сохранена итоговая сумма отложенных товаров.

Поля:
- `protected _list: HTMLElement` - элемент для размещения в нем карточек товаров, отложенных в корзину,
- `protected _total: HTMLElement` - элемент для отображения общей стоимости отложенных товаров в корзину,
- `protected _button: HTMLButtonElement` - элемент кнопки, для перехода на этап оформления заказа.

Методы: 
- `set items(items: HTMLElement[])` - сеттер для размещения внутри элемента _list отложенных в корзину карточек товаров,
- `set selected(items: string[])` - сеттер блокирующий/активирующий кнопку, в случаи отсутсвия/наличия карточек в корзине,
- `set total(total: number)` - сеттер для установки значения общей стоимости отложенных товаров в корзину.

>>#### Класс Form
Класс Form наследует класс Сomponent. Предназначен для отображения формы содержащей поля ввода.
`constructor(protected container: HTMLFormElement, protected events: IEvents)` - в конструктор передается элемент темплейта формы и экземпляр `EventEmitter` для инициации события, при нажатии пользователем на кнопку (submit) формы и при вводе данных в поля формы. 

Поля:
- `protected _submit: HTMLButtonElement` - элемент кнопки submit формы,
- `protected _errors: HTMLElement` - элемент для отображения ошибки при некорректно заполненной формы.

Методы:
- `protected onInputChange(field: keyof T, value: string)` - инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных.
- `set valid(value: boolean)` - сеттер изменяет активность кнопки подтверждения,
- `set errors(value: string)` - сеттер устанавливает значение текста ошибки, возникшей при некорректном заполнении полей форм,
- `render(state: Partial<T> & IFormState)` - расширяет родительский метод.

>>>#### Класс OrderForm
Класс OrderForm наследует класс Form. Предназначен для отображения формы с выбором способа оплаты и ввода адреса доставки. В конструктор передается элемент темплейта формы и экземпляр `EventEmitter` для инициации событий. При нажатии кнопки submit данной формы, происходит переход к следующей форме. 

Поля:
- `protected _buttonPayments: HTMLButtonElement[];` - массив с элементами кнопок, отвечающих за выбор способа оплаты.

Метод:
- `set address(value: string)` - сеттер устанавливает значение для поля адрес формы,

>>>#### Класс ContactsForm
Класс ContactsForm наследует класс Form. Предназначен для отображения формы для ввода email и телефона. При нажатии кнопки submit данной формы, происходит отправка запроса на оформление заказа на сервер.

Методы:
- `set email(value: string)` - сеттер устанавливает значение для поля email формы,
- `set phone(value: string)` - сеттер устанавливает значение для поля телефон формы.

>>#### Класс Success
Наследует класс Сomponent. Отвечает за отображение информации об успешном оформлении заказа и суммы списания.

- `constructor(container: HTMLElement, actions: ISuccessActions)` -  в конструктор передается элемент темплейта соответствующего блока и объект с функцией обработчик события по клику на кнопку, при нажатии на которую очищается корзина, закрывается модальное.

Поля класса:
- `protected _close: HTMLElement` - кнопка закрытия, 
- `protected _successDescription: HTMLElement` - элемент для отображения суммы списания.

Метод:
- `set total(value: number)` - сеттер устанавливает текст со значением суммы списания.

>### Слой коммуникации

>>#### Класс IWebLarekAPI
Наследует класс Api. Класс IWebLarekAPI предоставляет методы реализующие взаимодействие с бэкендом сервиса.

>## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий\
В `index.ts` сначала создаются:
- все шаблоны темплейтов,
- экземпляр класса модели данных: AppState,
- экземпляры классов глобальных контейнеров: Page,Modal,
- экземпляры классов переиспользуемых частей интерфейса: Basket,OrderForm,ContactsForm./
Далее настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards:changed` - изменение элементов каталога товаров,
- `orderformErrors:change` - изменение состояния валидации формы выбора способа оплаты и адреса доставки, данных об ошибки 
- `contactsFormErrors:change` - изменение состояния валидации формы для ввода контактных данных, данных об ошибки 

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки для отображения в модальном окне,
- `basket:open`  - открытие модального окна с корзиной. Событие, генерируемое при нажатии на иконку корзины на главной странице и при нажатии на иконку ведерко у карточки в каталоге корзины,
- `order:open` - событие, генерируемое при нажатии кнопки "Оформить" корзины, в результате чего происходит открытие модального окна с формой выбора способа оплаты и адреса доставки,
- `buttonPayments:select` - выбор способа оплаты,
- `order.address:change` - изменение значения адреса, при вводе в поле формы выбора способа оплаты и адреса доставки,
- `order:submit` - событие, генерируемое при нажатии кнопки "Далее" в форме выбора способа оплаты и адреса доставки, в результате чего происходит открытие модального окна с формой для ввода контактных данных,
- `contacts.email:change` - изменение значения email, при вводе в поле формы для ввода контактных данных,
- `contacts.phone:change` -  изменение значения телефона, при вводе в поле формы для ввода контактных данных,
- `contacts:submit` - событие, генерируемое при нажатии кнопки "Оплатить" в форме для ввода контактных данных, в результате чего формируется запрос к серверу с данными заказа. При успешной отработки сервером запроса, открывается модальное окно с элементом Success,
- `modal:open` - блокировка прокрутки страницы, если открыто модальное окно,
- `modal:close` - разблокировка прокрутки страницы, если закрыто модальное окно,
- `order:clear` - после успешного оформления заказа, после закрытия модального окна кликом  по крестику/кликом по оверлею, очищаются поля объекта зака order модели данных, обнуляется счетчик, отложенных товаров в корзину, на главной странице.
